<html>
<head>
<title>N/X 4.1 Installationshandbuch</title>
<link rel="stylesheet" href="format.css" type="text/css">
</head>

<body>

<div style="margin-left: 100px;">

<p style="font-size: 12pt;">&nbsp;</p>

<p style="font-size: 16pt;"><b>N/X 4.1<br />
Installationshandbuch</b></p>

<p>&nbsp;</p>

<p>Autor: Sven Weih<br />
&lt;sven [at] nxsystems org&gt;</p>

<p>&nbsp;</p>

</div>

<hr />

<h1>Inhaltsverzeichnis</h1>

<p class="toc1"><a href="#toc1">1. Installation</a></p>
<p class="toc2"><a href="#toc1-1">1.1. Systemvoraussetzungen</a></p>
<p class="toc2"><a href="#toc1-2">1.2. PHP Konfiguration</a></p>
<p class="toc2"><a href="#toc1-3">1.3. Entpacken des Pakets</a></p>
<p class="toc2"><a href="#toc1-4">1.4. Anlegen der Datenbank</a></p>
<p class="toc2"><a href="#toc1-5">1.5. Die Konfigurationsdateien von N/X 4.1</a></p>
<p class="toc3"><a href="#toc1-5-1">1.5.1. Anpassen der config.inc.php</a></p>
<p class="toc2"><a href="#toc1-5-2">1.5.2. Anpassen der settings.inc.php</a></p>
<p class="toc4"><a href="#toc1-5-2-1">1.5.2.1. Pfade und URLS konfigurieren</a></p>
<p class="toc4"><a href="#toc1-5-2-2">1.5.2.2. Fortgeschrittene Konfiguration</a></p>
<p class="toc5"><a href="#toc1-5-2-2-1">1.5.2.2.1. Standardpfade</a></p>
<p class="toc5"><a href="#toc1-5-2-2-2">1.5.2.2.2. Caching I</a></p>
<p class="toc5"><a href="#toc1-5-2-2-3">1.5.2.2.3. Wohin mit Fotos?</a></p>
<p class="toc5"><a href="#toc1-5-2-2-4">1.5.2.2.4. Caching II</a></p>
<p class="toc5"><a href="#toc1-5-2-2-5">1.5.2.2.5. Interne Verzeichnisse</a></p>
<p class="toc4"><a href="#toc1-5-2-3">1.5.2.3. Konfiguration der Datenbank</a></p>
<p class="toc4"><a href="#toc1-5-2-4">1.5.2.4. Die Standardsprache setzen (Variation)</a></p>
<p class="toc4"><a href="#toc1-5-2-5">1.5.2.5. Erzeugen statischer HTML-Seiten -- Statisches Caching</a></p>
<p class="toc4"><a href="#toc1-5-2-6">1.5.2.6. Das Backend lokalisieren</a></p>
<p class="toc4"><a href="#toc1-5-2-7">1.5.2.7. Seitenstatistiken</a></p>
<p class="toc4"><a href="#toc1-5-2-8">1.5.2.8. Austausch von Daten -- N/X Syndication</a></p>
<p class="toc4"><a href="#toc1-5-2-9">1.5.2.9. Firewalls und IP-Locking</a></p>
<p class="toc4"><a href="#toc1-5-2-10">1.5.2.10. Dynamisches Caching</a></p>
<p class="toc4"><a href="#toc1-5-2-11">1.5.2.11. Wenn kein Cache passt -- Der Query-Cache</a></p>
<p class="toc4"><a href="#toc1-5-2-12">1.5.2.12. Wenn die Website zu groß wird</a></p>
<p class="toc4"><a href="#toc1-5-2-13">1.5.2.13. Backup</a></p>
<p class="toc2"><a href="#toc1-6">1.6. Die erste Anmeldung</a></p>
<p class="toc1"><a href="#toc2">2. Sicherheit</a></p>
<p class="toc2"><a href="#toc2-1">2.1. Schutz von Verzeichnissen</a></p>
<p class="toc2"><a href="#toc2-2">2.2. Gesicherte Verbindungen mit SSL (Windows)</a></p>
<p class="toc2"><a href="#toc2-3">2.3. Gesicherte Verbindungen mit SSL (Linux)</a></p>
<p class="toc2"><a href="#toc2-4">2.4. Authentifizierung mit Zertifikaten</a></p>
<p class="toc2"><a href="#toc2-5">2.5. Checkliste für korrekte Installation</a></p>
<p class="toc1"><a href="#toc3">3. Deployment</a></p>
<p class="toc2"><a href="#toc3-1">3.1. Setup von Slave-Servern</a></p>
<p class="toc2"><a href="#toc3-2">3.2. Setup des Master-Servers</a></p>
<p class="toc3"><a href="#toc3-2-1">3.2.1. Konfiguration für FTP-Deployment</a></p>
<p class="toc3"><a href="#toc3-2-2">3.2.2. Deployment mit Netzwerkfreigaben</a></p>
<p class="toc3"><a href="#toc3-2-3">3.2.3. Tipps</a></p>

<hr />

<h1><a name="toc1"></a>1. Installation</h1>

<h2><a name="toc1-1"></a>1.1. Systemvoraussetzungen</h2>

<p class="block">Zur Installation von N/X 4.1 benötigen Sie folgende
Softwareprogramme:</p>

<ul>
  <li>Apache Web-Server</li>
  <li>PHP 4.3.0 oder besser</li>
  <li>MySQL Datenbank</li>
  <li>ca. 10MB Webspace für Basissystem und Speicher für die Website</li>
</ul>

<p class="block">Zusätzlich sind folgende Module/Add-Ons empfehlenswert:</p>

<ul>
  <li>PHP ZIP-Extension</li>
  <li>PHP GD/GD2-Extension</li>
  <li>PHP ImageMagick-Extension</li>
</ul>

<p class="block">Die Wahl des Betriebssystem ist unerheblich, da N/X nach
offenen Standards entwickelt wurde. Wir empfehlen aber den Einsatz folgender
Betriebssysteme:</p>

<ul>
  <li>Linux</li>
  <li>Windows</li>
  <li>Unix oder ähnliche Derivate</li>
  <li>Mac OS X</li>
</ul>

<p class="block">Zum Testen von N/X spielt es keine Rolle, welches
Betriebssystem Sie verwenden, für den Produktivbetrieb empfehlen wir aber aus
Leistungsgründen dringend einen Linux, Unix oder Windows-Server. Windows-Server
machen insbesondere dann Sinn, wenn Sie über einen COM-Server auf Daten
zugreifen wollen um diese mit N/X zu verarbeiten.</p>

<h2><a name="toc1-2"></a>1.2. PHP Konfiguration</h2>

<p class="block">Für ein gut funktionierendes System, ist eine optimale
Konfiguration der Sprache PHP nicht unerheblich. Wir empfehlen Ihnen die
mitgelieferte <tt>php.ini-dist</tt> Datei zu benutzen. Sollten Sie sich für die
<tt>php.ini-recommended</tt> entscheiden, dann stellen Sie bitte sicher, dass
folgender Eintrag genau so in der Datei enthalten ist:</p>

<p class="cmd"><tt>error_reporting = E_ALL &amp; ~E_NOTICE</tt></p>

<p class="block">Während in N/X 2002 die Option <tt>register_globals</tt> auf
jeden Fall aktiviert sein musste, ist dies in N/X 4.1 nun egal. Wir empfehlen
Ihnen sogar, <tt>register_globals=off</tt> zu benutzen, um Ihre
Systemsicherheit zu verbessern.</p>

<p class="block">PHP bietet Ihnen auf Servern, die von mehreren Benutzern
gleichzeitig genutzt werden, den sogenannten <b>Safe-Mode</b>, mit dem Ihre
Dateien vor unbefugten Zugriffen geschützt werden. Auf Windows-Rechnern macht
der Safe-Mode meistens keine Problem, nicht jedoch unter Linux. Stellen Sie
sicher, dass alle Dateien und Verzeichnisse dem selben Benutzer gehören, mit
dem auch PHP läuft. Fragen Sie Ihren Hoster für nähere Informationen und nutzen
Sie den <tt>chown</tt> Befehl, um die Dateieigentümer zu setzen. Je nach
Konfiguration des Apache-Servers können Sie übrigens einige Einstellungen auch
direkt mit der Hilfe von <tt>.htaccess</tt>-Dateien vornehmen.</p>

<h2><a name="toc1-3"></a>1.3. Entpacken des Pakets</h2>

<p class="block">Suchen Sie sich eine der verfügbaren Distributionen auf
unserer SourceForge-Projektseite aus (<a
href="http://sourceforge.net/projects/nxwcms/"
target="_blank">http://sf.net/projects/nxwcms/</a>). Anschließend entpacken Sie
das Archiv in ein Verzeichnis auf ihrem Webserver. Wenn Sie die
<tt>tar.bz2</tt>-Version unter Linux gewählt haben, nutzen Sie den Befehl
<tt>tar -jxf nx4.1_xxx.tbz2</tt> um das Archiv zu entpacken.</p>

<p class="block">Anschließend müssen Sie die <b>Verzeichnisrechte korrekt
setzen</b>, um zum einen Ihre Dateien zu schützen, zum anderen auch um N/X zu
ermöglichen Dateien zu ändern. Zunächst überprüfen Sie den N/X-Dateibaum auf
Vollständigkeit:</p>

<table class="bordered">
  <tr>
    <td><tt>/cms</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>/cms/api</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>/cms/cache</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>/cms/ext</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>/cms/help</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>/cms/modules</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>/cms/plugins</tt></td>
    <td>(Neue Plugins hier hinein kopieren)</td>
  </tr>
  <tr>
    <td><tt>/sql</tt></td>
    <td>(Löschen Sie dieses Verzeichnis nach der Installation)</td>
  </tr>
  <tr>
    <td><tt>/wwwdev</tt></td>
    <td>(Dieser Ordner enthält die Entwicklungsversion der Homepage)</td>
  </tr>
  <tr>
    <td><tt>/www</tt></td>
    <td>(Dieser Ordner enthält die Live-Version der Homepage)</td>
  </tr>
</table>

<p class="block">Anschließend müssen unter Linux die Rechte korrekt gesetzt
werden. Nutzen Sie dazu die Kommandos <tt>chown</tt> und <tt>chmod</tt>. Sie
sollten folgende Rechte setzen:</p>

<table class="bordered">
  <tr>
    <td><tt>/</tt></td>
    <td>(<tt>r-x</tt>, Lesen+Schreiben für alle (Unter-)Verzeichnisse,<br />
      <tt>r--</tt>, Nur-Lesen für alle Dateien)</td>
  </tr>
  <tr>
    <td><tt>/cms/cache</tt>,<br />
      <tt>/wwwdev</tt>,<br />
      <tt>/www</tt></td>
    <td>(<tt>rwx</tt>, Lesen+Schreiben+Ausführen(Suchen) für alle (Unter-)Verzeichnisse,<br />
      <tt>rw-</tt>, Lesen+Schreiben für alle Dateien)</td>
  </tr>
</table>

<p class="cmd"><tt>cd /usr/www/htdocs/nx4.1/<br />
chown -R wwwrun:nogroup .<br />
find . -type d -print0 | xargs -0 chmod 700<br />
find . -type f -print0 | xargs -0 chmod 600<br />
chmod -R u+rwX {cms/cache,wwwdev,www}</tt></p>

<p class="block">Wobei <tt>wwwrun</tt> der User ist, unter welcher der
Webserver läuft. Die Dateien werden der Gruppe <tt>nogroup</tt> gegeben, was
hier nur zur Vereinheitlichung dient. (Die Rechte wurden ja so vergeben, dass
kein Gruppenzugriff möglich ist.)</p>

<h2><a name="toc1-4"></a>1.4. Anlegen der Datenbank</h2>

<p class="block">Im Unterverzeichnis <tt>sql</tt> finden Sie folgende
Dateien:</p>

<table class="bordered">
  <tr>
    <td><tt>nx4.1_example.sql</tt></td>
    <td>Nutzen Sie diese Datei, um ein neues N/X System mit der Beispielwebsite zu installieren.</td>
  </tr>
  <tr>
    <td><tt>nx4.1_clean.sql</tt></td>
    <td>Nutzen Sie diese Datei, um eine neues N/X System mit einer leeren Datenbank zu installieren. Das System enthält dann keine Seiten, Grafiken und Texte mehr.</td>
  </tr>
  <tr>
    <td><tt>update.sql</tt></td>
    <td>Nutzen Sie diese Datei, um ein Update von N/X 2002 auf N/X 4.1 durchzuführen. Sichern Sie vor einem Update auf jeden Fall Ihre alte Datenbank und Ihr altes System!</td>
  </tr>
  <tr>
    <td><tt>clean.sql</tt></td>
    <td>Nutzen Sie diese Datei, um eine vorhandene N/X-Datenbank komplett zu löschen und wieder mit einem leeren System zu beginnen. Das willkürliche Ausführen dieser Datei führt zur Zerstörung Ihrer Website!</td>
  </tr>
  <tr>
    <td><tt>clean_stats.sql</tt></td>
    <td>Nutzen Sie diese Datei, um alle Statistiken innerhalb von N/X zu löschen. Die Statistiken sind anschließend verloren.</td>
  </tr>
</table>

<p class="block">Wählen Sie die richtige Datei für Ihre Zwecke. Bei einem
Update müssen Sie auf jeden Fall ein Backup der Datenbank und des vorhandenen
Systems vornehmen. Wir empfehlen Ihnen sogar, das komplette N/X System mitsamt
Ihrer Homepage auf einen temporären Rechner zu kopieren und alle Updates dort
auszuführen. Erst nach erfolgreicher Anpassung ist wieder alles zurück zu
kopieren.</p>

<p class="block">Zum Anlegen der Datenbank verwenden Sie am besten das Skript
<b>phpMyAdmin</b>. Sollten es noch nicht installiert sein, können Sie es unter
der Adresse <a href="http://phpmyadmin.net/"
target="_blank">http://phpmyadmin.net/</a> herunterladen.</p>

<p class="block">Alternativ können Sie auch mit der Kommandozeile von MySQL das
Datenbankskript einspielen. Starten Sie dazu das Programm <tt>mysql</tt> und
tippen Sie dann das folgende ein (nur für Experten!):</p>

<p class="cmd"><tt>connect DATENBANKNAME<br />
\. pfad.zur.sql.Datei</tt></p>

<h2><a name="toc1-5"></a>1.5. Die Konfigurationsdateien von N/X 4.1</h2>

<p class="block">Um N/X zu konfigurieren, müssen Sie die Dateien
<tt>config.inc.php</tt> und <tt>settings.inc.php</tt> im Verzeichnis
<tt>cms</tt> anpassen. Die Datei <tt>config.inc.php</tt> ist dabei
ausschließlich zum Einbinden des N/X-API zuständig, während alle relevanten
Einstellungen in der Datei <tt>settings.inc.php</tt> vorgenommen werden
müssen.</p>

<h3><a name="toc1-5-1"></a>1.5.1. Anpassen der config.inc.php</h3>

<p class="block">Sie sehen einen Auszug einer N/X 4.1 <tt>config.inc.php</tt>.
Es kann in einigen Version zu geringen Änderungen im Aussehen kommen.</p>

<p class="cmd"><tt>$c["path"] = "c:/web/nx4.1/cms/";<br />
require_once $c["path"] . "settings.inc.php";<br />
<br />
// Server configuration<br />
set_magic_quotes_runtime(0);<br />
$c_magic_quotes_gpc = get_magic_quotes_gpc();<br />
<br />
// load modules<br />
require_once $c["path"] . "plugin/plugin.inc.php";<br />
require_once $c["path"] . "api/database/lib.inc.php";<br />
require_once $c["path"] . "ext/adodb/adodb-session.php";<br />
require_once $c["path"] . "api/auth/lib.inc.php";<br />
require_once $c["path"] . "api/common/initialize.php";<br />
require_once $c["path"] . "api/common/lib.inc.php";<br />
require_once $c["path"] . "api/tools/lib.inc.php";<br />
require_once $c["path"] . "plugin/plugin.inc.php";<br />
require_once $c["path"] . "api/userinterface/lib.inc.php";<br />
require_once $c["path"] . "api/cms/lib.inc.php";<br />
require_once $c["path"] . "api/common/prepare.php";<br />
require_once $c["path"] . "api/xml/lib.inc.php";<br />
require_once $c["path"] . "api/parser/lib.inc.php";<br />
require_once $c["path"] . "api/tools/dump_get_post.php";<br />
<br /> 
$lang = new lang();</tt></p>

<p class="block">Die einzige Zeile, die Sie in dieser Datei anpassen sollten
ist folgende:<br /> <tt>$c["path"] = "c:/web/nx4.1/cms/";</tt></p>

<p class="block">Tragen Sie anstelle des Windows-Pfades
<tt>c:/web/nx4.1/cms/</tt> den korrekten Pfad zu Ihrer N/X Installation ein.
Liegt diese unter Linux z.B. im Ordner <tt>/usr/www/htdocs/nx4.1</tt>, so
tragen Sie dort <tt>/usr/www/htdocs/nx4.1/cms/</tt> ein. Achten Sie unbedingt
auf den <b>abschließenden Slash hinter <tt>cms</tt></b>!</p>

<h2><a name="toc1-5-2"></a>1.5.2. Anpassen der settings.inc.php</h2>

<p class="block">Auf den folgenden Seiten finden Sie einen Auszug einer
möglichen <tt>settings.inc.php</tt>. Wir werden nun alle Einstellungen im
Detail durchgehen.</p>

<p class="cmd"><tt>$c["basepath"] = "c:/web/nx4.1/";<br />
$c["basedocroot"] = "/nx4.1/";<br />
$c["host"] = "http://jupiter"; // address of your web-server<br />
$c_lang = "EN"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// Set default language to English!<br />
<br />
// Database variables<br />
$c["dbhost"] = "localhost";<br />
$c["database"] = "nx4.1"; // name of the database<br />
$c["dbuser"] = "root"; &nbsp; &nbsp; // name of the database user<br />
$c["dbpasswd"] = ""; &nbsp; &nbsp; &nbsp; // password of the database user<br />
$c["dbdriver"] = "mysql"; &nbsp;// type of your database<br />
$c["dbnow"] = "NOW()";<br />
$c["dbcode"] = "3dYqpm8UhF";<br />
<br />
// CDS Configuration<br />
$c["stdvariation"] = 1;<br />
$c["renderstatichtml"] = false;<br />
$c["timeout"] = 180;<br />
$c["standardencoding"] = "text/html; charset=iso-8859-1";<br />
$c["pagetracking"] = true;<br />
$c["usewebbug"] = true;<br />
$c["trackexitpages"] = true;<br />
$c["usettf"] = false;<br />
<br />
// Syndication<br />
$c["provider"] = "www.nxsystems.org";<br />
<br />
// AUTH<br />
$c["disablehostchecking"] = false;<br />
<br />
// Dynamic Cache<br />
$JPCACHE_ON = false; &nbsp; // Turn caching on/off<br />
$JPCACHE_TIME = 900;<br />
$JPCACHE_USE_GZIP = 0; // Whether or not to use GZIP<br />
<br />
// CDS-Query-Cache<br />
$QUERY_CACHE = false; // Cache database queries done in www<br />
$QUERY_CACHE_TIME = 900;<br />
<br />
// User-Interface<br />
$c["disableClustersInTree"] = false;<br />
<br />
// Backup<br />
$c["backupStore"] = $c["basepath"] . "backup";<br />
$c["storeBackupFTP"] = false;<br />
$c["ftpUsername"] = "";<br />
$c["ftpPassword"] = "";<br />
$c["ftpServer"] = "";<br />
$c["ftpDir"] = "/";<br />
$c["ftpPort"] = 21;<br />
$c["deleteAfterFTP"] = false;<br />
<br />
// Server paths of N/X. These are examples.<br />
// Note: except $c["host"] all variables must end with a slash!<br />
$c["path"] = $c["basepath"] . "cms/";<br />
$c["docroot"] = $c["basedocroot"] . "cms/";<br />
$c["devpath"] = $c["basepath"] . "wwwdev/";<br />
$c["devdocroot"] = $c["basedocroot"] . "wwwdev/";<br />
$c["livepath"] = $c["basepath"] . "www/";<br />
$c["livedocroot"] = $c["basedocroot"] . "www/";<br />
$c["docroothtml"] = $c["livedocroot"];<br />
$c["devfilespath"] = $c["basepath"] . "wwwdev/images/";<br />
$c["devfilesdocroot"] = $c["basedocroot"] . "wwwdev/images/";<br />
$c["livefilespath"] = $c["basepath"] . "www/images/";<br />
$c["livefilesdocroot"] =  $c["livedocroot"] . "images/";<br />
$c["cachepath"] = $c["livepath"] . "pages/";<br />
$c["cachedocroot"] = $c["livedocroot"] . "pages/";<br />
$c["tmpcachepath"] = $c["cachepath"] . "tmp/";<br />
$c["dyncachepath"] = $c["cachepath"] . "tmp/";<br />
$c["spmthumbpath"] = $c["path"] . "modules/sitepages/thumbnails/";<br />
$c["spmthumbdocroot"] = $c["docroot"] . "modules/sitepages/thumbnails/";<br />
$c["themepath"] = $c["path"] . "api/userinterface/themes/standard/";<br />
$c["themedocroot"] = $c["docroot"] . "api/userinterface/themes/standard/";</tt></p>

<h4><a name="toc1-5-2-1"></a>1.5.2.1. Pfade und URLS konfigurieren</h4>

<p class="block">Um die Pfade korrekt zu konfigurieren, müssen Sie folgende
Variablen anpassen. Beachten Sie bitte, dass <b>alle Pfade mit einem Slash
enden</b> müssen, die <b>Ausnahme</b> ist die Variable <tt>$c["host"]</tt>.</p>

<p class="cmd"><tt>$c["basepath"] = "c:/web/nx4.1/";<br />
$c["basedocroot"] = "/nx4.1/";<br />
$c["host"] = "http://jupiter";</tt></p>

<p class="block">Wir erinnern uns an die Konfigurationsvariable
<tt>$c["path"]</tt> in der Datei <tt>config.inc.php</tt>. Ziehen Sie das
<tt>cms/</tt> ab und schreiben Sie es nach <tt>$c["basepath"]</tt>. In N/X gilt
im übrigen folgende Regel: Alle Variablen, die das lokale Dateisystem
beschreiben enden auf <i>path</i>, alle, die mit der Beschreibung von URLs zu
tun haben, mit der Endung <i>docroot</i>.</p>

<p class="block">Die Variablen <tt>$c["basedocroot"]</tt> und
<tt>$c["host"]</tt> hängen gewissermaßen voneinander ab. Beide hintereinander
ausgeschrieben ergeben die URL, an welcher der Inhalt des <tt>nx4.1</tt>
Verzeichnisses zu finden ist. Haben Sie den Apache-Server so konfiguriert, dass
er bereits nach dem Hostnamen auf das NX4.1-Verzeichnis zugreift (z.B. durch
Apache's <tt>VirtualHosts</tt>), so ändern Sie den basedocroot auf <tt>/</tt>.
Bei der Einstellung der beiden Variablen sollten Sie nur beachten, dass der
Host nicht mit Slash endet, der basedocroot doch auf jeden Fall mit Slash
beginnt und mit Slash endet.</p>

<p class="block">Hinweis: Wenn Sie hier mit den Slashes etwas
durcheinanderbringen, kann das System zwar durchaus funktionieren, spätestens
aber bei der Verwendung von statischem Caching werden Sie Probleme
bekommen!</p>

<h4><a name="toc1-5-2-2"></a>1.5.2.2. Fortgeschrittene Konfiguration</h4>

<p class="cmd"><tt>$c["path"] = $c["basepath"] . "cms/";<br />
$c["docroot"] = $c["basedocroot"] . "cms/";<br />
$c["devpath"] = $c["basepath"] . "wwwdev/";<br />
$c["devdocroot"] = $c["basedocroot"] . "wwwdev/";<br />
$c["livepath"] = $c["basepath"] . "www/";<br />
$c["livedocroot"] = $c["basedocroot"] . "www/";<br />
$c["docroothtml"] = $c["livedocroot"];<br />
<br />
$c["devfilespath"] = $c["basepath"] . "wwwdev/images/";<br />
$c["devfilesdocroot"] = $c["basedocroot"] . "wwwdev/images/";<br />
$c["livefilespath"] = $c["basepath"] . "www/images/";<br />
$c["livefilesdocroot"] =  $c["livedocroot"] . "images/";<br />
<br />
$c["cachepath"] = $c["livepath"] . "pages/";<br />
$c["cachedocroot"] = $c["livedocroot"] . "pages/";<br />
$c["tmpcachepath"] = $c["cachepath"] . "tmp/";<br />
$c["dyncachepath"] = $c["cachepath"] . "tmp/";<br />
<br />
$c["spmthumbpath"] = $c["path"] . "modules/sitepages/thumbnails/";<br />
$c["spmthumbdocroot"] = $c["docroot"] . "modules/sitepages/thumbnails/";<br />
$c["themepath"] = $c["path"] . "api/userinterface/themes/standard/";<br />
$c["themedocroot"] = $c["docroot"] . "api/userinterface/themes/standard/";</tt></p>

<h5><a name="toc1-5-2-2-1"></a>1.5.2.2.1. Standardpfade</h5>

<p class="block">Unter normalen Umständen müssen Sie die obige Konfiguration
nicht anpassen. Wir empfehlen Ihnen sogar dringend, die Finger davon zu lassen,
wenn Sie nicht sicher sind, was Sie gerade ändern. In ein paar Sonderfällen
sind aber manuelle Eingriffe notwendig, z.B. dann, wenn sie den
<tt>www</tt>-Ordner in den Root Ihres Webservers kopieren möchten.</p>

<p class="block">Wir gehen eine solche Konfiguration nun Schritt für Schritt
durch. Wir nehmen an, dass der Inhalt des <tt>www</tt>-Ordners direkt in den
Root des Webservers verschoben wurde und dass das <tt>wwwdev</tt> und das
<tt>cms</tt>-Verzeichnis ebenfalls direkt unter dem Root des Webservers
liegen.</p>

<p class="block">Die Variable <tt>$c["path"]</tt> kennen Sie bereits aus der
<tt>config.inc.php</tt>. Sie muss exakt denselben Inhalt haben. Hier wird sie
dynamisch zusammengesetzt, was in den meisten Konfigurationen tadellos
funktioniert. Ändern Sie den Pfad nur, falls Sie den <tt>cms</tt>-Ordner an
eine andere Stelle relativ zu <tt>$c["basepath"]</tt> verschoben haben.</p>

<p class="block">Das Pendant von <tt>$c["path"]</tt> als URL auf Ihrem
Webserver wird in der Variablen <tt>$c["docroot"]</tt> hinterlegt. Dort steht
die URL zum Verzeichnis <tt>nx4.1/cms</tt>. Gerade wenn ein Login in das CMS
fehlt schlägt, ist meist ein falscher <tt>$c["docroot"]</tt> oder ein falscher
<tt>$c["basedocroot"]</tt> verantwortlich.</p>

<p class="block">Im Folgenden werden wir Pfad auf der Festplatte und
entsprechende URL immer paarweise besprechen.</p>

<p class="cmd"><tt>$c["devpath"] = $c["basepath"] . "wwwdev/";
$c["devdocroot"] = $c["basedocroot"] . "wwwdev/";</tt></p>

<p class="block">Pfad zum Verzeichnis <tt>wwwdev</tt>. Sollten Sie Templates in
das System hochladen wollen, dann laden Sie diese immer in dieses Verzeichnis.
Das System kopiert bei einem Launch automatisch die Vorlage in das
<tt>www</tt>-Verzeichnis. Eine Ausnahme sind die Bibliotheksdateien, die Sie
nicht direkt einem Template zugeordnet haben. Diese müssen Sie nach Stand
Februar 4.1 noch von Hand kopieren, wir arbeiten aber bereits an einer Lösung,
die vielleicht bereits verfügbar ist.</p>

<p class="cmd"><tt>$c["livepath"] = $c["basepath"] . "www/";<br />
$c["livedocroot"] = $c["basedocroot"] . "www/";</tt></p>

<p class="block">Pfad zum Verzeichnis <tt>www</tt>. Während in <tt>wwwdev</tt>
die Templates der <b>Entwicklungsversion Ihrer Homepage</b> liegen, sind in
<tt>www</tt> die Dateien der Live-Website. Ändern Sie nie ein Template direkt
im <tt>www</tt>-Ordner, sondern immer nur im <tt>wwwdev</tt>-Ordner und
Launchen Sie diese anschließend.</p>

<h5><a name="toc1-5-2-2-2"></a>1.5.2.2.2. Caching I</h5>

<p class="cmd"><tt>$c["docroothtml"] = $c["livedocroot"];</tt></p>

<p class="block">Sie können mit N/X statische HTML-Dateien erzeugen. Nehmen wir
an, Sie installieren N/X auf Ihrem PC zu Hause. Wenn Sie jetzt <b>statisches
HTML</b> erzeugen würden, dann würde N/X dies so machen, dass es für die Pfade
auf Ihrem Rechner zu Hause richtig ist. Ich betreibe eine Website unter der URL
<a href="http://weih.de/" target="_blank">http://weih.de/</a>. Die statischen
Dateien möchte ich auf meinen Server in das Verzeichnis <tt>info</tt>
hochladen. Die gesamte URL würde also <tt>weih.de/info</tt> lauten. Um dies zu
realisieren, trage ich hier also <tt>$c["docroothtml"] =
"http://weih.de/info/";</tt> ein. Der abschließend Backslash ist wie immer
wichtig!</p>

<h5><a name="toc1-5-2-2-3"></a>1.5.2.2.3. Wohin mit Fotos?</h5>

<p class="cmd"><tt>$c["devfilespath"] = $c["basepath"] . "wwwdev/images/";
$c["devfilesdocroot"] = $c["basedocroot"] . "wwwdev/images/";
$c["livefilespath"] = $c["basepath"] . "www/images/";
$c["livefilesdocroot"] =  $c["livedocroot"] . "images/";</tt></p>

<p class="block">Die folgenden Pfade beschreiben die Ordner, in denen N/X
Dateien speichert. Der Ordner heißt standardmäßig <tt>images</tt>, da in den
meisten Fällen dort ausschließlich Ihre Bilder gespeichert werden. Benennen Sie
diese Ordner ruhig um. Wir unterscheiden wieder die Entwicklungs- und die
Live-Version von Dateien (dev vs. live). Wird eine Datei das erste Mal
hochgeladen, landet Sie im <tt>dev</tt>-Verzeichnis. Beim Launchen einer Seite
wird sie automatisch in den Live-Ordner kopiert.</p>

<h5><a name="toc1-5-2-2-4"></a>1.5.2.2.4. Caching II</h5>

<p class="cmd"><tt>$c["cachepath"] = $c["livepath"] . "pages/";
$c["cachedocroot"] = $c["livedocroot"] . "pages/";
$c["tmpcachepath"] = $c["cachepath"] . "tmp/";
$c["dyncachepath"] = $c["cachepath"] . "tmp/";</tt></p>

<p class="block">Die aufgeführten Pfade deinen ausschließlich zum Cachen von
Seiten und damit zur Erhöhung der Systemleistung. N/X unterscheidet zwei Arten
von Caching: Dynamisches und Statisches. Beim statischen Caching wird eine
HTML-Datei erzeugt, die bis zum nächsten Launch nicht mehr verändert wird. Beim
dynamischen Caching, welches auf dem Skript JPCache 2.0 basiert, wird eine
HTML-Datei erzeugt und für eine Zeitspanne von ca. 15 Minuten lang gecachet.
Wann immer ein Zugriff auf diese Seite erfolgt, wird zunächst die gecachte
Version ausgeliefert. Mehr dazu später. Die Pfade <tt>cachepath</tt> und
<tt>cachedocroot</tt> dienen der Angabe des Verzeichnisses, in dem die
statischen HTML-Dateien gespeichert werden sollen.</p>

<p class="block">Um bei statischen Seiten 404-Fehler während des
Renderingvorgangs beim Launch zu vermeiden, werden diese zunächst in einem
temporären Ordner erzeugt und an schließend erst in den Caching Ordner kopiert.
Der temporäre Ordner für statische Cache-Dateien wird in
<tt>$c["tmpcachepath"]</tt> definiert. Nach N/X-Standard ist dies gleichzeitig
auch der Ordner für die dynamischen Cachedateien. Sie können diesen Ordner aber
unter <tt>$c["dyncachepath"]</tt> flexibel einstellen.</p>

<h5><a name="toc1-5-2-2-5"></a>1.5.2.2.5. Interne Verzeichnisse</h5>

<p class="cmd"><tt>$c["spmthumbpath"] = $c["path"] . "modules/sitepages/thumbnails/";
$c["spmthumbdocroot"] = $c["docroot"] . "modules/sitepages/thumbnails/";
$c["themepath"] = $c["path"] . "api/userinterface/themes/standard/";
$c["themedocroot"] = $c["docroot"]."api/userinterface/themes/standard/";</tt></p>

<p class="block">Die Variable <tt>$c["spmthumb</tt>...<tt>"]</tt> speichert den
Ordner, in dem Sie Thumbnails für Seitenvorlagen hinterlegen können. Möchte ein
Redakteur eine neue Seite anlegen, so werden die Templates in einer grafischen
Liste mit Symbolen dargestellt. Die Symbole sind in diesem Ordner gelagert. Wir
empfehlen den Standardordner <tt>nx4.1/cms/modules/sitepages/thumbnails</tt>
beizubehalten.</p>

<p class="block">Seit N/X 4.1 können Sie für das Benutzerinterface <b>eigene
Themes</b> erstellen und definieren. Beachten Sie, dass diese Themes
ausschließlich für das Backoffice verwendet werden! Die Themes werden im
Verzeichnis <tt>nx4.1/cms/api/userinterface/themes</tt> gespeichert. Wählen
Sie hier einfach ein Theme für das System aus. Die Vorgabe ist
<tt>standard</tt>.</p>

<h4><a name="toc1-5-2-3"></a>1.5.2.3. Konfiguration der Datenbank</h4>

<p class="cmd"><tt>// Database variables<br />
$c["dbhost"] = "localhost";<br />
$c["database"] = "nx4.1"; // name of the database<br />
$c["dbuser"] = "root"; &nbsp; &nbsp; // name of the database user<br />
$c["dbpasswd"] = ""; &nbsp; &nbsp; &nbsp; // password of the database user<br />
$c["dbdriver"] = "mysql"; &nbsp;// type of your database<br />
$c["dbnow"] = "NOW()";<br />
$c["dbcode"] = "3dYqpm8UhF";</tt></p>

<p class="block">Wir gehen davon aus, dass die Erklärung der
Datenbankkonfiguration annähernd selbsterklärend ist, weshalb wir die
Konfiguration in folgender Tabelle zusammenfassen.</p>

<table class="bordered">
  <tr>
    <td><tt>dbhost</tt></td>
    <td>Adresse zu Ihrem Datenbankserver. Sollten Sie den Port ändern wollen, kontaktieren Sie uns bitte unter <tt>sven@nxsystems.org</tt>.</td>
  </tr>
  <tr>
    <td><tt>database</tt></td>
    <td>Name der Datenbank in die Sie das N/X-Dump gespielt haben.</td>
  </tr>
  <tr>
    <td><tt>dbuser</tt></td>
    <td>Benutzername zur Anmeldung an der Datenbank.<br />
      Wenn Sie auf Nummer Sicher gehen wollen, verbieten Sie das Anlegen und Löschen von Tabellen. Dann können Sie aber keine Plugins mehr installieren!</td>
  </tr>
  <tr>
    <td><tt>dbpasswd</tt></td>
    <td>Passwort des Datenbankbenutzers</td>
  </tr>
  <tr>
    <td><tt>dbdriver</tt></td>
    <td>Verwendete Datenbank. Momentan wird nur <tt>mysql</tt> unterstützt.</td>
  </tr>
  <tr>
    <td><tt>dbnow</tt></td>
    <td>Intern, nicht ändern!</td>
  </tr>
  <tr>
    <td><tt>dbcode</tt></td>
    <td>Intern, nicht ändern! Wird nur noch zu Kompatibilität für N/X 2002
      gehalten.</td>
  </tr>
</table>

<p class="block">Außer MySQL werden momentan keine Datenbankserver unterstützt.
N/X 4.1 arbeitet anders als Version 2002 mit dem Abstraktionslayer ADOdb. Wir
nutzen einen weiteren zusätzlichen Abstraktionslayer, um unsere Abfragen zu
cachen und zusammenzubauen. Dort kann zukünftig die Unterstützung für weitere
Datenbankserver implementiert werden.</p>

<h4><a name="toc1-5-2-4"></a>1.5.2.4. Die Standardsprache setzen
(Variation)</h4>

<p class="block">In N/X heißen Sprachen Variationen. Dies hat den Hintergrund,
dass Sie eine Variation nicht nur als Sprache, sondern auch um unterschiedliche
Qualitäten eines Inhalts oder Ausprägungen für unterschiedliche Endgeräte
nutzen können. Die Standardvariation (Sprache) ist nun die, die das System
immer dann nutzt, wenn keine andere Variation angegeben ist oder wenn keine
andere Variation vorhanden ist.</p>

<p class="cmd"><tt>$c["stdvariation"] = 1;</tt></p>

<p class="block">Folgende Zeile legt die Standardvariation fest. <tt>1</tt>
entspricht dabei der Selektion "Standard". Wenn Sie eine andere Sprache als
Standardvariation festlegen möchten, dann legen Sie diese zunächst unter
"Administration/Variationen" an. Anschließend lassen Sie sich die
Datenbanktabelle <tt>variations</tt> anzeigen und wählen die
<tt>VARIATION_ID</tt> aus, die Sie als Standard setzen möchten. Wenn Sie
möchten können Sie in der Tabelle <tt>variations</tt> übrigens auch den Namen
von Standard in "Deutsch" oder "Englisch" umbenennen.</p>

<h4><a name="toc1-5-2-5"></a>1.5.2.5. Erzeugen statischer HTML-Seiten --
Statisches Caching</h4>

<p class="cmd"><tt>$c["renderstatichtml"] = false;<br />
$c["timeout"] = 180;</tt></p>

<p class="block">Mit Hilfe von <tt>renderstatichtml</tt> können Sie das
Erzeugen statischer HTML-Seiten aktivieren. Die Aktivierung bedeutet aber noch
nicht zwangsläufig, dass alle Seiten statisch generiert werden, sondern erst
einmal, dass dies generell möglich ist. Auf jeder Website im System können Sie
unter dem Reiter "Page Properties" das Caching für die jeweilige Seite
aktivieren.</p>

<p class="block">Die Variable <tt>timeout</tt> legt fest, wie lange das System
zum Erzeugen der statischen Seiten maximal Zeit hat. Die Angabe erfolgt in
Sekunden, Standardeinstellung sind 180 Sekunden = 3 Minuten. Gerade wenn Sie
ganze Seitenordner launchen (Launch tree), müssen manchmal bis zu 1000 oder
mehr Seiten neu erstellt werden. Berechnen Sie pro Seite eine Puffer von 2-3
Sekunden, bei langsamen Servern eher mehr und setzen Sie den Timout
dementsprechend. Wenn Sie also öfter mal 100 Seiten gleichzeitig neu Launchen,
setzen Sie den Timeout mindestens auf 300 Sekunden.</p>

<h4><a name="toc1-5-2-6"></a>1.5.2.6. Das Backend lokalisieren <!--
Lokalisieren == Finden --></h4>

<p class="block">Wenn Sie N/X in einer Sprache wie Chinesisch oder Russisch
nutzen, ist das Einstellen des Standard-Encodings von Bedeutung.</p>

<p class="cmd"><tt>$c["standardencoding"] = "text/html; charset=iso-8859-1";
$c["lang"] = "EN";</tt></p>

<p class="block">Informieren Sie sich, welchen Zeichensatz Sie für Ihre Sprache
wählen müssen und ersetzten sie den Eintrag unter <tt>charset</tt>. Mit Hilfe
der Variablen <tt>$c["lang"]</tt> setzen Sie die Standardsprache für das
Backend. Diese wird immer dann genutzt, wenn eine Beschriftung oder ein
Hilfetext nicht in der gewählten Sprache des Nutzers vorhanden ist.
Voreinstellung ist "EN".</p>

<h4><a name="toc1-5-2-7"></a>1.5.2.7. Seitenstatistiken</h4>

<p class="block">N/X bietet Ihnen integrierte Seitenstatistiken auf Basis von
phpOpenTracker (<a href="http://phpopentracker.org/"
target="_blank">http://phpopentracker.org</a>). Sie können die
Seitenstatistiken mit dem Schalter <tt>$c["pagetracking"]</tt> komplett
deaktiveren.</p>

<p class="cmd"><tt>$c["pagetracking"] = true;<br />
$c["usewebbug"] = true;<br />
$c["trackexitpages"] = true;<br />
$c["usettf"] = false;</tt></p>

<p class="block">Mit Hilfe der Einstellung <tt>$c["usewebbug"]</tt>, legen Sie
fest, ob N/X bei einem Seitenzugriff direkt in die Datenbank schreiben soll
oder ob ein transparenter Pixel, ein sogenannter Webbug bzw. Fliege eingebunden
werden soll, der die Zählung vornimmt. Wenn Sie Caching, egal ob dynamisches
oder statisches, nutzen sollten Sie immer den Webbug benutzen, da sonst nur
beim Erstellen und Schreiben der Datei in den Cache ein Hit aufgezeichnet wird
und viele Statistiken nicht richtig funktionieren.</p>

<p class="block">Mit Hilfe des Schalters <tt>$c["trackexitpages"]</tt> können
Sie festlegen, ob N/X sich die Links merken soll, die ein Benutzer gewählt und
Ihre Website anschließend verlassen hat. Trackexitpages funktioniert nicht mit
dem Webbug. Ebenso funktioniert die Auswertung nach Suchmaschinen nicht, wenn
Sie den Webbug nutzen.</p>

<p class="block">Tipp: Nutzen Sie für die Startseite immer die direkte
Aufzeichnung von Daten und für die restlichen Seiten die Fliege. Wie das geht
erfahren Sie im Entwicklerhandbuch.</p>

<p class="block">N/X wertet Statistiken grafisch aus. Auf Wunsch wird die
Schriftart "Tahoma" dafür verwendet. Aktivieren Sie hierfür
<tt>$c["usettf"]</tt>.</p>

<p class="block">Warnung: Aufgrund eines Bugs in PHP oder der GD-Bibliothek
sollten Sie unter Windows die Option <tt>$c["usettf"]</tt> dringendst
deaktivieren!</p>

<h4><a name="toc1-5-2-8"></a>1.5.2.8. Austausch von Daten -- N/X
Syndication</h4>

<p class="block">Viele Nutzer von N/X 2002 warten schon lange auf eine
Möglichkeit, Cluster-Templates, Page-Templates (in N/X 2002 Sitepage-Master)
oder Cluster untereinander auszutauschen. Der Export- und der Import-Wizard
sowie das neue CMS- und XML-API ermöglichen dies auf einfache und
unkomplizierte Art.</p>

<p class="cmd"><tt>$c["provider"] = "www.nxsystems.org";</tt></p>

<p class="block">Damit Ihre Daten richtig zugeordnet werden können, müssen Sie
vor der Nutzung des Import- und Export-Assistenten einen eindeutigen Namen
einstellen, um die Datenquelle zu identifizieren. Wir haben hier für den Namen
der Datenquelle <tt>$c["provider"]</tt> die URL unserer Homepage gewählt.</p>

<p class="block">Dies hat folgenden Hintergrund: Angenommen Sie tauschen mit
einem anderen Benutzer Cluster aus. Der andere Benutzer kann nichts mit den
Clustern anfangen, wenn er nicht das zugrunde liegende Cluster-Template hat.
Folglich muss auch das Cluster-Template mit exportiert werden. Damit nun nicht
bei jedem Import ein neues Cluster-Template angelegt werden muss, wertet N/X
den Provider der Daten und die ID des Datensatzes aus. Daten die bereits
importiert wurden, werden nicht erneut importiert. Dies gilt auch für Cluster.
Ein Update von Daten beim Import ist momentan nicht möglich.</p>

<h4><a name="toc1-5-2-9"></a>1.5.2.9. Firewalls und IP-Locking</h4>

<p class="block">Viele Benutzer klagten über Probleme mit Firewalls, die Ihnen
bei jedem Zugriff auf das Backend eine neue IP-Adresse zuordneten. N/X
speichert bei der Anmeldung eines Benutzers die IP-Adresse und vergleicht Sie
bei jedem Zugriff des Nutzers. Hat Sie sich geändert, so wird der Zugriff
automatisch verweigert. Dies kollidiert natürlich mit einigen
Unternehmensfirewalls. Übrigens bedeutet dieses Verhalten auch, dass ein
Benutzer nur einmal und nicht mehrfach am Backend angemeldet sein kann!</p>

<!-- In CVS "disalbe" into "disable" aendern. -->
<p class="cmd"><tt>$c["disablehostchecking"] = false;</tt></p>

<p class="block">Um dieses Sicherheitsfeature zu deaktivieren, setzen Sie den
Wert der Variable <tt>$c["disablehostchecking"]</tt> auf <tt>true</tt>.</p>

<h4><a name="toc1-5-2-10"></a>1.5.2.10. Dynamisches Caching</h4>

<p class="block">N/X verwendet JPCACHE um Seiten dynamisch zwischenzuspeichern.
Dies verleiht vor allem Systemen mit häufigen Zugriffen und einigen
semi-dynamischen Inhalten einen deutlichen Performanceschub. Sie können den
Cache jederzeit durch <tt>$JP_CACHE_ON = true</tt> aktivieren.</p>

<p class="cmd"><tt>$JPCACHE_ON = false; &nbsp; // Turn caching on/off<br />
$JPCACHE_TIME = 900;<br />
$JPCACHE_USE_GZIP = 0; // Whether or not to use GZIP</tt></p>

<p class="block">Mit <tt>$JPCACHE_TIME</tt> stellen Sie ein, nach wie vielen
Sekunden (default 15 Minuten = 900 Sekunden) eine Seite im Cache ungültig wird
und neu erstellt werden muss. Durch Aktivieren von <tt>$JPCACHE_USE_GZIP</tt>
können Sie zusätzlich die gecacheten Dateien im GZIP-Format packen. Die
Besonderheit liegt darin, dass fast alle Browser HTML-GZIP-Dateien entpacken
können und Ihre Website dadurch noch einmal schneller wird und Sie ganz
nebenbei auch Traffic einsparen.</p>

<p class="block">Tipp: Bei Websites, auf denen Sie täglich News pflegen und
nicht mehr als 250.000 Zugriffe pro Tag haben, empfehlen wir Ihnen prinzipiell
statisches Caching nicht zu verwenden und auf dynamisches zurückzugreifen. Bei
anderen Rahmenbedingungen heißt es Ausprobieren, was Ihr Server leistet.
Generell ist dynamisches Cachen aber mit wesentlich weniger
Administrationsaufwand verbunden, da Sie den <!-- OT: statischen --> Cache
nicht "von Hand flushen" müssen -- der dynamische Cache flusht sich praktisch
selbst. Ein Flushen von Hand wird immer dann nötig, wenn sich auf gecachten
statischen Seiten das Menü oder Teaser ändern sollen. Zwar bietet N/X eine
Liste mit IDs, die beim Launch einer Seite immer mitgeflusht werden sollen,
beim Einsatz von Kanälen könnte dies aber mitunter das Flushen der kompletten
Website bedeuten.</p>

<h4><a name="toc1-5-2-11"></a>1.5.2.11. Wenn kein Cache passt -- Der Query-Cache</h4>

<p class="cmd"><tt>$QUERY_CACHE = false; // Cache database queries done in www<br />
$QUERY_CACHE_TIME = 900;</tt></p>

<p class="block">Wenn Sie weder statisches noch dynamisches Caching verwenden
können -- dies ist immer der Fall wenn Sie eine speziell auf einen Benutzer
zugeschnittene Seite anzeigen -- hilft Ihnen der QUERY-CACHE weiter. Alle
Ergebnisse von SQL-Anfragen, die von der Website aus abgesetzt werden, werden
auf der Festplatte zwischengespeichert. Bei einer erneuten Anfrage werden die
Ergebnisse dann sofort eingelesen. Bitte beachten Sie zum Einsatz des
Query-Cache, dass sie im Ordner <tt>/cms/cache/adodb</tt> N/X sämtliche Rechte
zugestehen.</p>

<p class="block">Zusätzlich müssen Sie(!) den <b>Ordner mit einem Passwort
schützen</b>, sodass niemand von außen darauf zugreifen kann. (Vgl. Kapitel
Sicherheit.) Angenommen Sie haben eine Ergebnisliste mit Kreditkartenummern,
die Sie unverschlüsselt in der Datenbank gespeichert haben, so könnte man durch
Probieren an diese Daten gelangen. Verschlüsseln Sie also auch alle sensiblen
Daten!</p>

<h4><a name="toc1-5-2-12"></a>1.5.2.12. Wenn die Website zu groß wird</h4>

<p class="cmd"><tt>$c["disableClustersInTree"] = false;</tt></p>

<p class="block">Wenn Ihre Website zu groß wird, werden viele Steuerelemente
innerhalb von N/X langsam, insbesondere alle Bäume und Menüs die auf Basis von
JavaScript arbeiten. Setzen Sie die Variable <tt>$c["disableClustersInTree"] =
true</tt>, wenn sich Ihre Entwickler und Redakteure über ein zu langsames
System beschweren bzw. über ein System, das früher mal schneller war. Beachten
Sie, dass dabei etwas Komfort verloren geht.

<h4><a name="toc1-5-2-13"></a>1.5.2.13. Backup</h4>

<p class="cmd"><tt>$c["backupStore"] = $c["basepath"] . "backup";<br />
$c["storeBackupFTP"] = false;<br />
$c["ftpUsername"] = "";<br />
$c["ftpPassword"] = "";<br />
$c["ftpServer"] = "";<br />
$c["ftpDir"] = "/";<br />
$c["ftpPort"] = 21;<br />
$c["deleteAfterFTP"] = false;</tt></p>

<p class="block">Seit N/X 4.1 können Sie von Ihrer Website und von Ihrer
Datenbank automatisch ein Backup erstellen lassen. Damit dies funktioniert,
müssen Sie zunächst den lokalen Pfad, in dem die Backups gespeichert werden,
erstellen und mit allen Rechten versehen. Als Standardordner schlagen wir in
<tt>$c["backupStore"]</tt> <tt>/nx4.1/cms/backup</tt> vor, wenn Sie aber einen
dedizierten Server Ihr eigenen nennen, so speichern Sie die Backups auf jeden
Fall außerhalb des Web-Roots. Wieder gilt, dass Sie auf jeden Fall den Ordner
mit einem Passwort schützen müssen!</p>

<p class="block">Nun nutzt Ihnen ein Backup auf dem lokalen Server nichts, wenn
Sie einen Hardwaredefekt haben. Deshalb bietet Ihnen N/X die Möglichkeit, Ihre
Backups via FTP auf einen anderen Rechner zu übertragen. Um diese Funktion zu
aktivieren, setzen Sie <tt>$c["storeBackupFTP"] = true</tt> und konfigurieren
die weiteren Variablen, gemäß der folgenden Tabelle:</p>

<!-- Einige sind "Ftp", andere "FTP" ?? Korrigieren CVS und hier -->
<table class="bordered">
  <tr>
    <td><tt>FtpUsername</tt></td>
    <td>Benutzername zum Login auf Ihrem FTP-Server</td>
  </tr>
  <tr>
    <td><tt>FtpPassword</tt></td>
    <td>Passendes Passwort zum Benutzernamen</td>
  </tr>
  <tr>
    <td><tt>FTPServer</tt></td>
    <td>Adresse des FTP-Servers</td>
  </tr>
  <tr>
    <td><tt>FtpDir</tt></td>
    <td>Verzeichnis auf dem FTP-Server, in das die Backupdateien gespeichert
      werden sollen</td>
  </tr>
  <tr>
    <td><tt>FTPPort</tt></td>
    <td>Port des FTP-Servers (Standardport: 21)</td>
  </tr>
  <tr>
    <td><tt>DeleteAfterFTP</tt></td>
    <td>Sollen das Backup lokal gelöscht werden, nachdem es via FTP übertragen
      wurde?</td>
  </tr>
</table>

<p class="block">Nachdem Sie nun die <tt>settings.inc.php</tt> Datei komplett
konfiguriert und verstanden haben, sollte N/X einsatzbereit sein.</p>

<h2><a name="toc1-6"></a>1.6. Die erste Anmeldung</h2>

<p class="block">Melden Sie sich nach erfolgter Installation am System an und
überprüfen Sie zunächst, ob alles funktioniert, wie Sie sich das vorstellen.
Nichts ist ärgerlicher als wenn Sie Entwickler auf das System loslassen, das
eigentlich noch gar nicht richtig funktioniert, da die Rechte falsch
konfiguriert sind.</p>

<p class="block">Falsch konfigurierte Rechte sind dann auch die häufigste
Ursache, weshalb N/X Probleme macht. Überprüfen Sie der Reihe nach folgende
URLs:</p>

<p class="cmd"><tt>nx4.1/cms<br />
nx4.1/wwwdev<br />
nx4.1/www</tt></p>

<p class="block">Wenn Sie die Pfade in der <tt>settings.inc.php</tt> geändert
haben, nutzen Sie Ihre neuen Pfade. Sollte auf der Seite <tt>nx4.1/cms</tt>
ein Fehler kommen wie "<tt>Session could not be started</tt>", dann haben Sie
ein Problem mit der Datenbank. Überprüfen Sie dann Ihre
Datenbankkonfiguration.</p>

<p class="block">Gehen Sie nun auf <tt>nx4.1/cms</tt>. Melden Sie sich mit
Ihrem Benutzernamen an:</p>

<table>
  <tr>
    <td align="right">Benutzername:</td>
    <td>Administrator</td>
  </tr>
  <tr>
    <td align="right">Passwort:</td>
    <td>Administrator</td>
  </tr>
</table>

<p class="block">Das System hält Sie nun 4 Sekunden hin, in denen es eine
kleine Pause macht. Dies ist eine kleine Sicherheitsmaßnahme gegen
Brute-Force-Attacken. Ändern Sie nach erfolgter Anmeldung als erstes Ihre
Passwort unter "Administration/My Profile". Gehen Sie anschließend auf
"Administration/Access" und löschen oder deaktivieren Sie alle Benutzer, die
Sie nicht brauchen. Das Passwort aller dort aufgelisteter Standardbenutzer ist
gleich dem Benutzernamen.</p>

<p class="block">Überprüfen Sie nun das System, ob alles so arbeitet, wie Sie
es sich vorstellen und legen Sie anschließend die Benutzerkonten für Ihre
Redakteure und Entwickler an.</p>

<hr />

<h1><a name="toc2"></a>2. Sicherheit</h1>

<h2><a name="toc2-1"></a>2.1. Schutz von Verzeichnissen</h2>

<p class="block">Wie bereits mehrfach erwähnt, sollten Sie unbedingt einige
Verzeichnisse im System, auf die kein Internetbenutzer Zugriff haben darf
schützen. Dazu zählen unbedingt das Verzeichnis des Query-Cache und das
Verzeichnis, in dem Ihre Backups abgelegt werden. Wir empfehlen aber dringend,
das komplette <tt>nx4.1/cms</tt>-Verzeichnis zu schützen. Die folgende
Schritt-für-Schritt-Anleitung zeigt Ihnen, wie es geht.</p>

<h3><a name="toc2-1-1"></a>2.1.1. Schritt 1</h3>

<p class="block">Suchen Sie das Programm <tt>htpasswd</tt> in Ihrem Apache
Ordner. Wir werden für den Ordner <tt>C:\Web\nx4.1\cms</tt> nun einen Benutzer
Namens <tt>sven</tt> mit Passwort <tt>123456</tt> anlegen. Bei dem Ordner
handelt es sich um einen Windows-Ordner. Unter Linux geht das ganz genauso, nur
dass der Ordner dann in etwa so aussieht: <tt>/usr/www/nx4.1/cms</tt>. Mit
Hilfe des Befehls</p>

<p class="cmd"><tt>htpasswd -c /usr/www/nx4.1/cms/.htpasswd sven</tt></p>

<p class="block">legen (<tt>-c</tt>) wir die Datei <tt>.htpasswd</tt> im Ordner
<tt>cms</tt> an. Der Befehl fragt Sie nach dem gewünschten Passwort. Es ist oft
ausreichend, wenn Sie für eine ganze Gruppe von Benutzern nur einen
Benutzernamen und ein Passwort haben.</p>

<p class="block">Die Datei sieht nach Ausführung des Befehls z.B. wie folgt
aus:</p>

<p class="cmd"><tt>sven:$apr1$R20.....$CLQ9L5OC8QRp0hlMOTtBT1</tt></p>

<p class="block">Sie können beliebig viele andere Benutzer hinzufügen. Rufen
Sie dazu den Befehl <tt>htpasswd</tt> ohne den Parameter <tt>-c</tt>, der für
Create steht, auf. Zum Ändern eines Passworts gehen sie genauso vor, rufen also
wieder <tt>htpasswd</tt> ohne <tt>-c</tt> mit dem Benutzernamen des zu
ändernden Passworts auf.</p>

<p class="block">Folgender Dump beschreibt die Funktionen und Parameter des
Befehls <tt>htpasswd</tt>.</p>

<p class="cmd"><tt>Usage:<br />
&nbsp; &nbsp; htpasswd [-cmdpsD] passwordfile username<br />
&nbsp; &nbsp; htpasswd -b[cmdpsD] passwordfile username password<br />
<br />
&nbsp; &nbsp; htpasswd -n[mdps] username<br />
&nbsp; &nbsp; htpasswd -nb[mdps] username password<br />
<br />
 -c &nbsp;Create a new file.<br />
 -n &nbsp;Don't update file; display results on stdout.<br />
 -m &nbsp;Force MD5 encryption of the password (default).<br />
 -d &nbsp;Force CRYPT encryption of the password.<br />
 -p &nbsp;Do not encrypt the password (plaintext).<br />
 -s &nbsp;Force SHA encryption of the password.<br />
 -b &nbsp;Use the password from the command line rather than prompting for it.<br />
 -D &nbsp;Delete the specified user.<br />
<br />
On Windows, NetWare and TPF systems the "-m" flag is used by default.<br />
On all other systems, the "-p" flag will probably not work.</tt></p>

<h3><a name="toc2-1-2"></a>2.1.2. Schritt 2</h3>

<p class="block">Nachdem wir nun eine Datei mit den Passworten erstellt haben,
müssen wir dem Apache-Server beibringen, welches Verzeichnis er damit schützen
soll. Wir tun das, indem wir eine <tt>.htaccess</tt> Datei im gleichen
Verzeichnis wie die <tt>.htpasswd</tt>-Datei erstellen. In die Datei schreiben
wir folgende Zeilen:</p>

<p class="cmd"><tt>AuthName "cms restricted area"<br />
AuthType Basic<br />
AuthUserFile "/usr/www/nx4.1/cms/.htpasswd"<br />
require valid-user</tt></p>

<p class="block">Der <tt>AuthName</tt> wird benutzt, um den Benutzer
anzuzeigen, wo er sich eigentlich anmelden möchte. <tt>AuthUserFile</tt> zeigt
auf die soeben erstellte Passwortdatei.</p>

<p class="block">Im Normalfall wird ab jetzt der Passwortschutz aktiv sein.
Falls nicht, kommen wir zu Schritt 3.</p>

<h3><a name="toc2-1-3"></a>2.1.3. Schritt 3</h3>

<p class="block">Wenn nach Schritt 2 der Passwortschutz noch nicht
funktioniert, liegt es an der Konfiguration Ihres Webservers. Suchen Sie die
folgende Passage in der <tt>httpd.conf</tt> Ihres Servers:</p>

<p class="cmd"><tt>&lt;Directory /&gt;<br />
&nbsp; &nbsp; Options FollowSymLinks<br />
&nbsp; &nbsp; AllowOverride None<br />
&lt;/Directory&gt;</tt></p>

<p class="block">Ändern Sie nun das <tt>None</tt> (bei <tt>AllowOverride</tt>)
in ein <tt>AuthConfig</tt> und starten Sie anschließend den Apache-Server
neu.</p>

<p class="block">Wenn es Ihnen widerstrebt, den Apache-Server komplett
umzukonfigurieren, dann erstellen Sie einfach ein neues Verzeichnis und
verzichten auf die <tt>.htaccess</tt> Datei. Angenommen N/X 4.1 liegt im
Verzeichnis <tt>C:\web\nx4.1\cms</tt>, dann sähe ein neuer Verzeichniseintrag
(in <tt>httpd.conf</tt>) wie folgt aus:</p>

<p class="cmd"><tt>&lt;Directory c:/web/nx4.1/cms&gt;<br />
&nbsp; &nbsp; AuthName "cms restricted area"<br />
&nbsp; &nbsp; AuthType Basic<br />
&nbsp; &nbsp; AuthUserFile "C:\Web\nx4.1\cms\.htpasswd"<br />
&nbsp; &nbsp; require valid-user<br />
&nbsp; &nbsp; Options FollowSymLinks<br />
&nbsp; &nbsp; AllowOverride None<br />
&lt;/Directory&gt;</tt></p>

<h2><a name="toc2-2"></a>2.2. Gesicherte Verbindungen mit SSL (Windows)</h2>

<p class="block">In diesem Kapitel werden wir Ihr Backoffice mit Hilfe einer
SSL-Verschlüsselung absichern. Damit stellen wir generell sicher, dass Sie
nicht abgehört werden, wenn Sie mit dem System arbeiten. Folgende
Schritt-für-Schritt Anleitung führt Sie wieder an das Ziel: Wir machen N/X mit
SSL sichererer.</p>

<h3><a name="toc2-2-1"></a>2.2.1. Schritt 1</h3>

<p class="block">Zunächst müssen wir das <tt>mod_ssl</tt>-Paket für Apache aus
dem Internet herunterladen. Eine Liste mit den passenden Dateien zum jeweiligen
Server finden wir unter <a href="http://apache-ssl.org/"
target="_blank">http://apache-ssl.org</a> oder <a
href="http://hunter.campbus.com/"
target="_blank">http://hunter.campbus.com</a>. Zusätzlich benötigen wir
OpenSSL. Dies finden Sie in der passenden Version zum jeweiligen
<tt>mod_ssl</tt> in der <tt>README</tt> angegeben oder für Windows-Benutzer
wieder passend unter http://hunter.campbus.com/ zum Download.</p>

<p class="block">Allerdings gibt es den Apache-Server auch schon komplett mit
SSL zum Download, was wesentlich einfacher ist.</p>

<h3><a name="toc2-2-2"></a>2.2.2. Schritt 2</h3>

<p class="block">Nach dem Download entpacken wir zunächst die Archive und
kopieren <tt>mod_ssl</tt> in das <tt>modules</tt>-Verzeichnis unter Apache und
<tt>openssl</tt> komplett in ein Unterverzeichnis <tt>openssl</tt> unter
Apache. Wichtig: Unter Windows müssen die Dateien <tt>ssleay32.dll</tt> und
<tt>libeay32.dll</tt> ins <tt>windows/system32</tt> bzw.
<tt>windows/system</tt> Verzeichnis (Win 9x) kopiert werden.</p>

<h3><a name="toc2-2-3"></a>2.2.3. Schritt 3</h3>

<p class="block">Jetzt laden wir eine Zielwahldatei <a
href="http://download.netzadmin.org/openssl.cnf"
target="_blank">http://download.netzadmin.org/openssl.cnf</a> herunter und
kopieren Sie in das Verzeichnis <tt>openssl</tt>. Dort starten wir die Datei
<tt>openssl.exe</tt>. Sie müssen nun die vier Befehle in der aufgeführten
Reihenfolge ausführen. Sie werden bei einigen Befehlen nach Angaben wir einem
Passwort usw. gefragt. Notieren Sie sich, was Sie dort angegeben haben oder
noch besser: Merken Sie es sich auswendig. Wichtig: Sie werden nach
<tt>CommonName</tt> gefragt. Dort müssen Sie den Namen Ihres Servers
eintragen.</p>

<p class="cmd"><tt>&gt; req -config openssl.cnf -new -out zertifikat.csr<br />
&gt; rsa -in privkey.pem -out zertifikat.key<br />
&gt; x509 -in zertifikat.csr -out zertifikat.crt -req -signkey zertifikat.key -days 365<br />
&gt; x509 -in zertifikat.crt -out zertifikat.der.crt -outform DER</tt></p>

<p class="block">Das erstellte Zertifikat ist 365 Tage lang gültig.</p>

<h3><a name="toc2-2-4"></a>2.2.4. Schritt 4</h3>

<p class="block">Erstellen Sie unter Apache einen Ordner <tt>zertifikate</tt>
und kopieren Sie die Dateien <tt>zertifikat.crt</tt>, <tt>zertifikat.key</tt>
und <tt>zertifikat.der.crt</tt> hinein.</p>

<h3><a name="toc2-2-5"></a>2.2.5. Schritt 5</h3>

<p class="block">Öffnen Sie die <tt>httpd.conf</tt> Ihres Apache-Servers. Fügen
Sie an das Ende der <tt>httpd.conf</tt> folgende Zeilen an, sollte dies noch
nicht geschehen sein: <!-- "sollte dies nicht geschen sein": angebracht?
--></p>

<p class="cmd"><tt>Listen 443<br />
LoadModule ssl_module modules/mod_ssl.so<br />
<br />
AddType application/x-x509-ca-cert .crt<br />
AddType application/x-pkcs7-crl &nbsp; &nbsp;.crl<br />
<br />
SSLPassPhraseDialog builtin<br />
SSLSessionCache dbm:logs/ssl_scache<br />
SSLSessionCacheTimeout 300<br />
SSLRandomSeed startup builtin<br />
SSLRandomSeed connect builtin<br />
<br />
&lt;VirtualHost jupiter:443&gt;<br />
&nbsp; &nbsp; DocumentRoot "c:/web"<br />
&nbsp; &nbsp; ServerName cms.jupiter:443<br />
&nbsp; &nbsp; ServerAdmin you@your.address<br />
&nbsp; &nbsp; ErrorLog logs/error_log<br />
&nbsp; &nbsp; TransferLog logs/access_log<br />
&nbsp; &nbsp; SSLEngine on<br />
&nbsp; &nbsp; SSLCipherSuite ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP:+eNULL<br />
&nbsp; &nbsp; SSLCertificateFile "c:/programme/apache group/apache2/zertifikat/zertifikat.crt"<br />
&nbsp; &nbsp; SSLCertificateKeyFile "c:/programme/apache group/apache2/zertifikat/zertifikat.key"<br />
&lt;/VirtualHost&gt;</tt></p>

<p class=2block">Ersetzen Sie die Pfade zu den Zertifikaten zu Ihren Ordnern
sowie den Namen des Virtual-Host. Im mod_ssl-Paket finden Sie weitere
Anleitungen und Beispiele, wie Sie SSL konfigurieren können.</p>

<h3><a name="toc2-2-6"></a>2.2.6. Schritt 6</h3>

<p class="block">Öffnen Sie die <tt>settings.inc.php</tt>. Ersetzen Sie bei
<tt>$c["host"] = "http://servername"</tt> durch
<tt>http<b><u>s</u></b>://servername</tt>. Sie nutzen jetzt ja SSL!</p>

<p class="block">Wenn Sie SSL zusammen mit dem Passwortschutz aus 2.1. nutzen,
dann haben Sie für N/X nun eine sichere Umgebung geschaffen. Seien Sie sich
aber darüber im Klaren, dass es vollkommene Sicherheit nicht gibt und dass jede
Software Fehler enthält!</p>

<h2><a name="toc2-3"></a>2.3. Gesicherte Verbindungen mit SSL (Linux)</h2>

<p class="block">Als Linux Administrator können Sie sicherlich bereits aus der
Windows-Hilfe einiges lernen. Um Unter Linux einen Apache-Server mit SSL
aufzusetzen, sind folgende Artikel hilfreich:</p>

<p class="block"><a
href="http://www.linux-magazin.de/Artikel/ausgabe/2000/08/Apache/Apache-SSL.html"
target="_blank">http://www.linux-magazin.de/Artikel/ausgabe/2000/08/Apache/Apache-SSL.html</a>
(Deutsch)<br /> <a href="http://www.linuxnetmag.com/de/issue6/m6ssl1.html"
target="_blank">http://www.linuxnetmag.com/de/issue6/m6ssl1.html</a>
(Deutsch)<br /> <a href="http://www.linuxhelp.net/guides/apachessl/"
target="_blank">http://www.linuxhelp.net/guides/apachessl/</a> (Englisch)</p>

<p class="block">Weiterhin bieten die meisten Distributionen ein vorgefertigtes
Paket an (oft <tt>mod_ssl</tt> o.ä.). Lesen Sie dort die Readme-Dateien für
weitere Informationen. Das Erstellen von Zertifikaten mit Hilfe von OpenSSL
funktioniert unter Linux genauso wie unter Windows.</p>

<h2><a name="toc2-4"></a>2.4. Authentifizierung mit Zertifikaten</h2>

<p class="block">Da das Backend von N/X nur von einem geschlossenen
Benutzerkreis genutzt wird, können Sie das System zusätzlich mit Hilfe von
Browserzertifikaten absichern. Dazu müssen Sie zunächst die Zertifikate für den
Browser erzeugen oder noch besser erzeugen lassen. Nutzen Sie eine
professionelle Zertifizierungsstelle -- das kostet Sie meist nur um die 100,-
Euro, bietet Ihnen aber die Sicherheit, dass alles korrekt ist.</p>

<p class="block">Um selbst Zertifikate zu erstellen, nutzen Sie OpenSSL mit dem
Befehl <tt>ca</tt>. Genauere Informationen dazu entnehmen Sie der Anleitung zu
OpenSSL unter <a href="http://www.openssl.org/docs/"
target="_blank">http://www.openssl.org/docs/</a>.</p>

<p class="block">Sobald Sie das Browserzertifikat erstellt haben, müssen Sie es
an Ihre Benutzer verteilen. Diese Installieren es anschließend in Ihren
Browsern. Damit die Authentifizierung mit Zertifikaten klappt müssen Sie
abschließend noch den Apache Server umkonfigurieren:</p>

<p class="cmd"><tt>Listen 443<br />
LoadModule ssl_module modules/mod_ssl.so<br />
<br />
AddType application/x-x509-ca-cert .crt<br />
AddType application/x-pkcs7-crl &nbsp; &nbsp;.crl<br />
<br />
SSLCACertificateFile "c:\programme\apache group\apache2\zertifikat\zertifikat.crt"<br />
<br />
&lt;Directory c:/web/nx4.1/cms&gt;<br />
&nbsp; &nbsp; SSLVerifyClient require<br />
&nbsp; &nbsp; SSLVerifyDepth 1<br />
&nbsp; &nbsp; require valid-user<br />
&nbsp; &nbsp; Options FollowSymLinks<br />
&nbsp; &nbsp; AllowOverride None<br />
&lt;/Directory&gt;</tt></p>

<p class="block">Stellen Sie sicher, dass außer dieser URL alle anderen
Zugriffsmöglichkeiten auf den Server abgestellt sind. Starten Sie Apache
anschließend neu.</p>

<h2><a name="toc2-5"></a>2.5. Checkliste für korrekte Installation</h2>

<table class="bordered">
  <tr>
    <th>Konfiguration</th>
    <th>Check</th>
  </tr>
  <tr>
    <td>PHP <tt>register_globals = off</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>PHP <tt>error_reporting = E_ALL &amp; ~E_NOTICE</tt></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Paket ist vollständig</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Verzeichnisrechte korrekt gesetzt</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Datenbank korrekt angelegt</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Datenbankverbindung klappt (Test mit z.B. phpMyAdmin)</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>config.inc.php</tt> editiert</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td><tt>settings.inc.php</tt> editiert</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>1. Login erfolgreich</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Durchklicken von N/X ohne Fehler</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Aufruf der Funktion <b>Rebuild Cache</b> (bei statischem Cache)</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Aufruf der Funktion <b>Rebuild Datatypes</b></td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Ändern der Passwörter aller Benutzter</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Apache mit SSL konfigurieren</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Clientauthentifizierung mit Zertifikaten</td>
    <td>&nbsp;</td>
  </tr>
  <tr>
    <td>Schutz der N/X Verzeichnisse</td>
    <td>&nbsp;</td>
  </tr>
</table>

<hr />

<h1><a name="toc3"></a>3. Deployment</h1>

<p class="block">Seit der Version 4.1 kann N/X Dateien automatisch auf mehrere
Webserver verteilen. Beim Launchen werden entweder statische HTML-Seiten auf
die Webserver verteilt oder es wird das entsprechende Template auf den
Webserver kopiert. Des Weiteren werden Bilddateien und Flashfilme auf die
Webserver kopiert.</p>

<p class="block">Für das Verteilen von Seiten auf mehrere Webserver empfehlen
wir dringend, statisches Caching zu verwenden. Beim Setzen der Pfade sollten
sie dann nur aufpassen, dass Sie keine absoluten sondern nur relative Pfade
verwenden. Wenn Sie also ein Bild auf Ihrem Stammserver unter der URI
<tt>http://server1/images/image1.jpeg</tt> ablegen, dann sollte dies auf Server
2 unter der URI <tt>http://server2/images/image1.jpeg</tt> zu finden sein. Wenn
dem so ist, können Sie und müssen Sie relative Pfade verwenden, d.h. dass das
Bild ab sofort unter der URI <tt>/images/image1.jpg</tt> zu finden ist.</p>

<h2><a name="toc3-1"></a>3.1. Setup von Slave-Servern</h2>

<p class="block">Sie benötigen einen Basisserver und können von ihm aus ca. 10
Slave-Server bedienen. Eine unabdingbare Voraussetzung sind schnelle
Verbindungen zwischen den Servern! Um einen Slave-Server einzurichten,
installieren Sie N/X auf diesem Server zunächst genau so, als wäre es ein
eigenständiges CMS-System. Anschließend löschen Sie folgende Dateien und
Verzeichnisse:</p>

<p class="cmd"><tt>cms/modules<br />
cms/index.php<br />
wwwdev</tt></p>

<p class="block">Den Rest behalten Sie bei. Bitte achten Sie auch darauf, dass
im Plugin-Ordner alle Plugins vorhanden sind, die auch im Mastersystem
installiert sind.</p>

<p class="block">Beim Konfigurieren der Datenbank tragen Sie am besten die
Datenbank des Master-Systems ein. Ihr Slave-System erhält also keine dedizierte
Datenbank. Gerade wenn Sie auf Caching vollständig verzichten müssen, kann dies
für Sie aber untragbar sein, weshalb Sie dann eine Datenbankreplikation
einrichten müssen. Die Datenbank wird dabei vom Mastersystem zyklisch auf das
Slavesystem repliziert. Alle Anwendungen, die auf dem CMS-Plugin basieren --
dazu zählen z.B. das Gästebuch -- oder ein N/X Forum, dürfen Sie dann
allerdings nicht mehr verwenden.</p>

<p class="block">Wir haben das Deployment ursprünglich dafür entwickelt, dass
parallel zum vorhandenen Webserver ein Backup-Server vorhanden ist, auf den man
schnell umschalten kann, falls der Hauptserver einen Defekt hat. Sie sollten
dazu allerdings auch die Datenbank durch eine externe Lösung regelmäßig
sichern, falls sich dort ein Defekt oder ein Fehler einschleicht.</p>

<p>Zusammenfassung:</p>

<ul>
  <li>Slave-Server wie einen normalen N/X-Server konfigurieren</li>
  <li>Statisches Caching ist sehr empfehlenswert</li>
  <li>Am besten auf beiden Systemen dieselbe Datenbank verwenden</li>
</ul>

<h2><a name="toc3-2"></a>3.2. Setup des Master-Servers</h2>
 
<p class="block">In der <tt>settings.inc.php</tt> des Master-Servers legen Sie
fest, auf welche Slave-Server Daten beim Launch automatisch übertragen werden
sollen. N/X kennt momentan die Übertragungsmodi FTP und Dateizugriff. Sie
können z.B. bereits vorhandene Netzwerkfreigaben (SMB/CIFS, NFS) nutzen, um die
Dateien von N/X direkt dorthin kopieren zu lassen. Im N/X Paket sind zwei
spezialisierte <tt>settings.inc.php</tt> Dateien enthalten. Eine mit der Endung
<tt>.fileconfig</tt>, eine mit der Endung <tt>.ftpconfig</tt>, die eine
Beispielkonfiguration für das jeweilige Deploymentprotokoll enthalten. Spicken
Sie dort, um zu sehen, wie Sie das Deployment ideal konfigurieren.</p>

<p class="block">Bevor Sie Slaves konfigurieren, sollten Sie die folgende Zeile
zur <tt>settings.inc.php</tt> hinzufügen:</p>

<p class="cmd"><tt>$c["ftplivepath"] = "www/";</tt></p>

<p class="block">Beachten Sie, dass der Pfad relativ zu <tt>$c["basepath"]</tt>
ist und ihr <tt>www</tt>-Verzeichnis beschreibt. Setzen Sie weiterhin die
Variable <tt>$c["cachedocroot"]</tt>, um die Pfade innerhalb der statischen
Dateien zu verändern. Wenn sie hier z.B. <tt>file:///c:/....</tt> eintragen,
dann wird das exakt so in den statischen HTML-Seiten stehen.</p>

<p class="block">Das Deployment auf die Slaves wird durch Setzen des Array
<tt>$deploy</tt> aktiviert. Für den ersten Server, auf den Sie die Daten
verteilen möchten, legen Sie das Array <tt>$deploy[0]</tt> an, für den zweiten
<tt>$deploy[1]</tt> usw. (Sodass <tt>$deploy</tt> also praktisch ein Array von
Arrays ist.)</p>

<h3><a name="toc3-2-1"></a>3.2.1. Konfiguration für FTP-Deployment</h3>

<p class="cmd"><tt>$deploy[0]["mode"] = "ftp"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// file or ftp<br />
$deploy[0]["ftpserver"] = "localhost"; &nbsp; &nbsp; &nbsp; // if ftp, server-address<br />
$deploy[0]["ftpport"] = 21; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// if ftp, server-port<br />
$deploy[0]["ftpuser"] = "test"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// if ftp, server-user<br />
$deploy[0]["ftppasswd"] = "test"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// if ftp, user-password<br />
$deploy[0]["ftprootdir"] = "/"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// if ftp, ftp-root-dir<br />
$deploy[0]["livepath"] = "www/"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // if ftp, ftp-live-files-path (pages)<br />
$deploy[0]["livefilespath"] = "www/images/"; // if ftp, ftp-live-data-files (images)-path<br />
$deploy[0]["cachepath"] = "www/pages/"; &nbsp; &nbsp; &nbsp;// path, where cache files go to</tt></p>
 
<p class="block">Durch setzen des <tt>MODE</tt> auf <tt>ftp</tt>, wird N/X
mitgeteilt, dass hier via FTP-Protokoll verteilt werden soll.</p>

<p class="block">Die <tt>ftp</tt>-Variablen beschreiben dann auch den Zugang
zum FTP-Server. In <tt>livepath</tt> setzen Sie den Pfad, wohin N/X die
Templates kopieren soll. Normalerweise ist dies das <tt>www</tt> Verzeichnis.
<tt>LivefilesPath</tt> beschreibt den Pfad, an den die Bilder auf den Slave
kopiert werden sollen, <tt>cachepath</tt> den Pfad, in dem statische
HTML-Seiten landen. Bitte beachten Sie hier, dass die Verzeichnis alle genauso
heißen müssen wie beim Mastersever und dass die Verzeichnisstruktur absolut
identisch sein muss!</p>

<h3><a name="toc3-2-2"></a>3.2.2. Deployment mit Netzwerkfreigaben</h3>

<p class="cmd"><tt>$deploy[1]["mode"] = "file"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // file or ftp
$deploy[1]["livepath"] = "z:/test/"; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // live files-path (pages)
$deploy[1]["livefilespath"] = "z:/test/images/"; // live-data-files (images) -path
$deploy[1]["cachepath"] = "z:/test/pages/"; &nbsp; &nbsp; &nbsp;// path, where cache files go to</tt></p>

<p class="block">Wie Sie erkennen können, ist als <tt>MODE</tt> diesmal
<tt>file</tt> eingetragen. Die Variablen <tt>livepath</tt>,
<tt>livefilespath</tt> und <tt>cachepath</tt> entsprechen denen im obigen
Beispiel. Wenn Sie diese betrachten, stellen Sie fest, dass N/X die Daten hier
"lokal" auf einem Windows-System verteilt. Nutzen Sie die "Netzlaufwerk
verbinden"-Funktion von Windows, UNC-Pfade (<tt>\\Computername\Freigabe</tt>)
oder den Linux <tt>mount</tt> Befehl für NFS, um die Dateien auf andere Rechner
zu übertragen.</p>

<h3><a name="toc3-2-3"></a>3.2.3. Tipps</h3>

<table class="bordered">
  <tr>
    <td>Wenn Sie CD-ROMs erstellen wollen, können Sie durch geeignetes Setzen
      des Deployments und durch statisches Caching eine Offline-Website für die
      CD erstellen.</td>
  </tr>
  <tr>
    <td>Sie können auf Ihrem Windows-Rechner N/X installieren und eine
      statische Homepage bequem via FTP auf Ihrem Webserver pflegen.</td>
  </tr>
</table>

<hr />
</body>
</html>
